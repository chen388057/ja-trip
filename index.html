<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 å¯’å‡ JAè¦ªå­æ—…è¡Œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --m-bg: #F4F1EE; --m-card: #FFFFFF; --m-ink: #333333; --m-red: #AF292E; }
        body { background-color: var(--m-bg); color: var(--m-ink); font-family: 'Noto Sans TC', sans-serif; -webkit-font-smoothing: antialiased; font-size: 19px; padding-bottom: 120px; margin: 0; }
        .muji-card { background: var(--m-card); border-radius: 24px; box-shadow: 0 6px 16px rgba(0,0,0,0.06); border: 1px solid #EAE6E2; overflow: hidden; margin-bottom: 20px; }
        .weather-banner { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); border: 1px solid #EAE6E2; border-radius: 20px; padding: 15px 20px; margin-bottom: 25px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; text-decoration: none; }
        .nav-active { background: #8E8A82 !important; color: white !important; transform: scale(1.05); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .bottom-nav { background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(15px); border-top: 1px solid #E5E5E5; padding-bottom: env(safe-area-inset-bottom); position: fixed; bottom: 0; left: 0; right: 0; height: 90px; display: flex; justify-content: space-around; align-items: center; z-index: 100; }
        .ledger-row { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #F0F0F0; }
        .ledger-input { border: none; border-bottom: 2px solid #EEE; background: transparent; width: 100%; padding: 12px 0; font-size: 18px; outline: none; }
        .map-wrapper { width: 100%; height: calc(100vh - 280px); border-radius: 24px; overflow: hidden; border: 1px solid #EAE6E2; background: #fff; }
        .map-wrapper iframe { width: 100%; height: 100%; border: none; }
        .badge-res { background: #FADBD8; color: var(--m-red); padding: 2px 8px; border-radius: 6px; font-weight: 800; font-size: 14px; }
        .nav-map-btn { display: inline-flex; align-items: center; background-color: #F8F9FA; color: #333; padding: 10px 18px; border-radius: 14px; font-size: 15px; font-weight: 700; margin-top: 14px; border: 1px solid #EEE; text-decoration: none; }
        .ticket-btn { display: flex; align-items: center; padding: 18px; background: #fff; border: 1px solid #EAE6E2; border-radius: 18px; margin-bottom: 12px; transition: all 0.2s; text-decoration: none; box-shadow: 0 2px 6px rgba(0,0,0,0.02); }
    </style>
</head>
<body>

    <header class="px-6 pt-14 pb-2 flex justify-between items-end">
        <div>
            <h1 class="text-3xl font-black tracking-tight text-stone-800">2026 JA Trip</h1>
            <div id="sync-status" class="text-[10px] text-green-600 font-bold mt-1 uppercase tracking-widest">â— System Active</div>
        </div>
        <p id="top-currency" class="text-xs font-bold text-stone-400 font-mono tracking-tighter uppercase">JPY MODE</p>
    </header>

    <nav class="sticky top-0 z-40 bg-[#F4F1EE]/95 backdrop-blur-md py-5 border-b border-stone-200">
        <div class="flex overflow-x-auto no-scrollbar px-6 space-x-4" id="date-nav"></div>
    </nav>

    <main class="px-6 py-6" id="main-content">è¼‰å…¥è¡Œç¨‹ä¸­...</main>

    <footer class="bottom-nav">
        <button onclick="switchMode('itinerary')" id="mode-itinerary" class="flex flex-col items-center gap-1 text-stone-800">
            <span class="text-2xl">ğŸ—“ï¸</span><span class="text-[9px] font-black uppercase">è¡Œç¨‹</span>
        </button>
        <button onclick="switchMode('map')" id="mode-map" class="flex flex-col items-center gap-1 text-stone-300">
            <span class="text-2xl">ğŸ“</span><span class="text-[9px] font-black uppercase">åœ°åœ–</span>
        </button>
        <button onclick="switchMode('ledger')" id="mode-ledger" class="flex flex-col items-center gap-1 text-stone-300">
            <span class="text-2xl">ğŸ’°</span><span class="text-[9px] font-black uppercase">è¨˜å¸³</span>
        </button>
        <button onclick="switchMode('master')" id="mode-master" class="flex flex-col items-center gap-1 text-stone-300">
            <span class="text-2xl">ğŸ§³</span><span class="text-[9px] font-black uppercase">ç¥¨åˆ¸</span>
        </button>
    </footer>

    <script type="module">
        // ğŸš€ ä½¿ç”¨ç›¸å®¹æ€§æœ€é«˜çš„ Firebase å¼•å…¥æ–¹å¼
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = { databaseURL: "https://ja-trip-2026-default-rtdb.firebaseio.com" };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // å…¨åŸŸè®Šæ•¸æ›è¼‰
        window.currentDayIdx = 0;
        window.currentMode = 'itinerary';
        window.expensesRaw = {};

        const myMapUrl = "https://www.google.com/maps/d/embed?mid=1vI66v55pndH60h58wFpInuY4G5uKOfM"; 
        const dates = ["1/24", "1/25", "1/26", "1/27", "1/28", "1/29", "1/30", "1/31", "2/1", "2/2"];
        
        const tripData = [
            { date: "1/24", city: "è¼•äº•æ¾¤", weather: "â„ï¸ -6Â°/-1Â°", items: [
                { time: "06:00", title: "æ ¼ä¸Šæ©Ÿå ´æ¥é€", desc: "å‰å¾€æ¡ƒåœ’åœ‹éš›æ©Ÿå ´ T2", loc: "æ¡ƒåœ’æ©Ÿå ´" },
                { time: "09:30", title: "è¯èˆª CI0100 âœˆï¸", desc: "æ©Ÿä½ <span class='badge-res'>47DEFG</span> (ç¶“æ¿Ÿè‰™)", loc: "æ¡ƒåœ’æ©Ÿå ´" },
                { time: "13:30", title: "æŠµé”æˆç”°æ©Ÿå ´", desc: "æŠµé”ç¬¬äºŒèˆªå»ˆé€šé—œ", loc: "æˆç”°æ©Ÿå ´" },
                { time: "15:00", title: "Skyliner ğŸš…", desc: "æˆç”° âœ äº¬æˆä¸Šé‡ | <span class='badge-res'>åˆ·è‡‰éé–˜æ©Ÿ</span>", loc: "äº¬æˆä¸Šé‡ç«™" },
                { time: "16:38", title: "æ–°å¹¹ç·š Hakutaka 571 ğŸš…", desc: "ä¸Šé‡ â” è¼•äº•æ¾¤ | <span class='badge-res'>9è™Ÿ1ç•ªABC / 2ç•ªCå¸­</span>", loc: "ä¸Šé‡ç«™" },
		Â { time: "17:35", title: "æŠµé”è¼•äº•æ¾¤ç«™", desc: "æº–å‚™æ­ä¹˜é£¯åº—æ¥é§", loc: "è¼•äº•æ¾¤è»Šç«™" },
                { time: "18:00", title: "å…¥ä½ Hotel Indigo ğŸ¨", desc: "é›™åºŠæˆ¿(å«æ—©) | é£¯åº—æ¥é§è»Šè‡³ç«™å—å£", loc: "Hotel Indigo Karuizawa" }
            ]},
            { date: "1/25", city: "è¼•äº•æ¾¤", weather: "â„ï¸ -8Â°/1Â°", items: [
                { time: "07:00", title: "é£¯åº—æ—©é¤ ğŸ³", desc: "Hotel Indigo æ—©é¤", loc: "Hotel Indigo Karuizawa" },
                { time: "08:30", title: "é›ªå ´æº–å‚™ ğŸ¿", desc: "æ±é¤¨é›ªå…·ç§Ÿè³ƒè™•é›†åˆã€æ›è£ã€é ˜é›ªç¥¨", loc: "è¼•äº•æ¾¤ç‹å­æ»‘é›ªå ´" },
                { time: "09:00", title: "æ»‘é›ªèª²ç¨‹ (å…¨æ—¥) ğŸ¿", desc: "æ¢é›ªè€…å­¸æ ¡èª²ç¨‹ | 12:00 åˆé¤(Snow House 2F)", loc: "è¼•äº•æ¾¤æ»‘é›ªå ´" },
                { time: "15:00", title: "å…¥ä½è¥¿é¤¨å°æœ¨å±‹ ğŸ¡", desc: "West D å€å°æœ¨å±‹ (ä¸å«æ—©)", loc: "Karuizawa Prince Hotel West" },
                { time: "16:30", title: "èˆŠè¼•äº•æ¾¤éŠ€åº§é€š", desc: "æ•£ç­–ã€è²·æœé†¬ã€åƒæ™šé¤ | å¯æ­é£¯åº—æ¥é§ç¶ ç·š", loc: "èˆŠè¼•äº•æ¾¤éŠ€åº§é€š" }
            ]},
            { date: "1/26", city: "è¼•äº•æ¾¤", weather: "â„ï¸ -5Â°/2Â°", items: [
                { time: "07:30", title: "è‡ªå‚™æ—©é¤ ğŸ¥¯", desc: "æœ¨å±‹æ™¨é¤" },
                { time: "08:30", title: "æ»‘é›ªèª²ç¨‹ Day 2 ğŸ¿", desc: "09:00~12:00 èª²ç¨‹ | 12:00 çµæŸå¾Œé›ªå ´ä¼‘æ¯", loc: "è¼•äº•æ¾¤æ»‘é›ªå ´" },
                { time: "13:00", title: "ç‹å­ Outlet ğŸ›ï¸", desc: "é ˜å–å„ªæƒ åˆ¸ | é€›æ¨‚é«˜ã€é‹å‹•ç”¨å“ã€Gap | è¶…å¸‚æ¡è²·", loc: "è¼•äº•æ¾¤ç‹å­è³¼ç‰©å»£å ´" },
	{ time: "17:00", title: "Outlet æ™šé¤ ğŸ±", desc: "ç‡Ÿæ¥­è‡³ 19:00", loc: "è¼•äº•æ¾¤ç‹å­è³¼ç‰©å»£å ´" }

            ]},
            { date: "1/27", city: "æ±äº¬", weather: "â˜ï¸ 2Â°/9Â°", items: [
                { time: "09:00", title: "Snowman Park â›„", desc: "10:00~12:00 ç©é›ªç›† | é–€ç¥¨Â¥1400", loc: "è¼•äº•æ¾¤æ»‘é›ªå ´" },
                { time: "13:57", title: "æ–°å¹¹ç·š Asama 616 ğŸš…", desc: "è¼•äº•æ¾¤ âœ æ±äº¬ | <span class='badge-res'>9è™Ÿ16/17ç•ªDEå¸­</span>", loc: "è¼•äº•æ¾¤è»Šç«™" },
                { time: "15:30", title: "å…¥ä½å”è‰é£¯åº— ğŸ¨", desc: "karaksa hotel colors (å«æ—©)", loc: "karaksa hotel colors Tokyo Yaesu" },
                { time: "16:00", title: "æ—¥æœ¬æ©‹å¯¶å¯å¤¢ä¸­å¿ƒ DX ğŸ‰", desc: "é«˜å³¶å±‹æ±é¤¨ 5F | è³¼è²·å¡ç‰Œ", loc: "å¯¶ä¸­å¿ƒ DX" },
                { time: "17:30", title: "ç¦ã¿ã¿ éŠ€åº§ 6 ğŸ¢ (é ç´„)", desc: "ä¸²ç‡’æ–™ç†å±…é…’å±‹", loc: "ä¸²ä¸²ç‡’ BISTRO ç¦ã¿ã¿" }
            ]},
            { date: "1/28", city: "æ±äº¬", weather: "â˜€ï¸ 4Â°/11Â°", items: [
                { time: "09:30", title: "æ±äº¬éµå¡”æ”å½±é» ğŸ—¼", desc: "èŠå…¬åœ’æ‹ç…§ä½ | èµ¤ç¾½æ©‹ç«™å‡ºå£", loc: "èŠå…¬åœ’" },
                { time: "11:00", title: "æ˜æ²»ç¥å®®åƒæ‹œ â›©ï¸", desc: "ç¥å®®æ•£ç­–ã€å¾¡æœ±å°", loc: "æ˜æ²»ç¥å®®" },
                { time: "12:30", title: "æ¾€è°·åˆé¤/è³¼ç‰© ğŸ›", desc: "Parco 6F (å¯¶å¯å¤¢/ä»»å¤©å ‚) | Montbell æ¾€è°·åº—", loc: "æ¾€è°· PARCO" },
                { time: "17:00", title: "æ±äº¬è»Šç«™ä¸€ç•ªè¡— ğŸ‰", desc: "å¯¶å¯å¤¢å°ˆè³£åº— | æ™šé¤ï¼šæ¯”å…§åœ°é›", loc: "æ±äº¬è»Šç«™ä¸€ç•ªè¡—" }
            ]},
            { date: "1/29", city: "æ±äº¬", weather: "â˜ï¸ 3Â°/10Â°", items: [
                { time: "09:00", title: "teamLab Planets âœ¨ (é ç´„)", desc: "éœ€è„«é‹è¥ªé€²å…¥è—è¡“å€", loc: "teamLab Planets TOKYO" },
                { time: "12:30", title: "å°å ´ Bills åˆé¤ ğŸ¥ (é ç´„)", desc: "ä¸–ç•Œç¬¬ä¸€é¬†é¤…", loc: "Bills Odaiba" },
                { time: "14:30", title: "æ¨‚é«˜æ¢ç´¢ä¸­å¿ƒ ğŸ§± (é ç´„)", desc: "å°å ´ Decks 3F", loc: "LEGOLAND Discovery Center" },
                { time: "18:00", title: "å‹äººé¤æ•˜ ğŸ·", desc: "Andrew & Maggie æ™šé¤èšæœƒ" }
            ]},
            { date: "1/30", city: "æ±äº¬", weather: "â˜€ï¸ 4Â°/12Â°", items: [
                { time: "09:30", title: "æ·ºè‰é›·é–€ğŸ®", desc: "åƒæ‹œã€ä»²è¦‹ä¸–é€šå°åƒ", loc: "æ·ºè‰é›·é–€" },
                { time: "11:00", title: "æ™´ç©ºå¡”ç™»å¡” ğŸ—¼ (é ç´„)", desc: "å¤©æœ›è¿´å»Šæ‹ç…§", loc: "æ±äº¬æ™´ç©ºå¡”" },
                { time: "12:00", title: "æ•˜æ•˜è‹‘ç‡’è‚‰ ğŸ¥© (é ç´„)", desc: "æ™´ç©ºå¡” 30F æ™¯è§€å¸­", loc: "æ•˜æ•˜è‹‘ æ™´ç©ºå¡”åº—" },
                { time: "15:00", title: "ä¸Šé‡ç§‘å­¸åšç‰©é¤¨ ğŸ¦– (é ç´„)", desc: "åœ‹ç«‹ç§‘å­¸åšç‰©é¤¨", loc: "åœ‹ç«‹ç§‘å­¸åšç‰©é¤¨" },
                { time: "18:00", title: "ã­ãã— ç‰›èˆŒå¥—é¤ ğŸ‘…", desc: "ä¸Šé‡ç«™å‰åº—", loc: "Negishi Ueno" }
            ]},
            { date: "1/31", city: "æ±äº¬", weather: "â˜ï¸ 5Â°/10Â°", items: [
                { time: "09:30", title: "æ± è¢‹æ°´æ—é¤¨ ğŸ§ (é ç´„)", desc: "çœ‹å¤©ç©ºä¼éµã€æµ·ç…è¡¨æ¼”", loc: "æ± è¢‹å¤ªé™½åŸæ°´æ—é¤¨" },
                { time: "12:30", title: "æ± è¢‹å¯¶å¯å¤¢ Mega ğŸ‰", desc: "æ± è¢‹æœ€å¤§åº— | æ‰­è›‹ä¸­å¿ƒ", loc: "Pokemon Center Mega" },
                { time: "14:00", title: "å¤ªé™½åŸé€›è¡— ğŸ›ï¸", desc: "å’Œå¹¸ç‚¸è±¬æ’ | MUJI | Loft", loc: "æ± è¢‹å¤ªé™½åŸ" },
                { time: "18:30", title: "å¡šç”°è¾²å ´æ™šé¤ ğŸ“ (é ç´„)", desc: "å…«é‡æ´²åŒ—å£åº—", loc: "å¡šç”°è¾²å ´" }
            ]},
            { date: "2/1", city: "æ›¼è°·", weather: "â˜€ï¸ 27Â°/34Â°", items: [
                { time: "05:30", title: "å‰å¾€æˆç”°æ©Ÿå ´ ğŸš•", desc: "CI0107 09:20 é£›å¾€å°åŒ—", loc: "æˆç”°æ©Ÿå ´" },
                { time: "12:30", title: "æŠµé”æ¡ƒåœ’è½‰æ©Ÿ", desc: "è½‰æ©Ÿ â” 13:50 CI0835 èµ·é£›", loc: "æ¡ƒåœ’æ©Ÿå ´" },
                { time: "16:45", title: "æŠµé”æ›¼è°· BKK âœˆï¸", desc: "CI0835 æ›¼è°·æŠµé” | å…¥å¢ƒé€šé—œ", loc: "è˜‡å‡¡ç´å¸ƒæ©Ÿå ´" },
                { time: "18:30", title: "å…¥ä½ MII Hotel ğŸ¨", desc: "MII Hotel Srinagarindra", loc: "MII Hotel Srinagarindra" },
                { time: "19:30", title: "æ›¼è°·ç«é‹æ™šé¤ ğŸ²", desc: "MK ç«é‹", loc: "Seacon Square" }
            ]},
            { date: "2/2", city: "æ­¸é€”", weather: "â˜€ï¸ å°ç£é å ±", items: [
                { time: "10:00", title: "æ›¼è°·å”å‰è¨¶å¾· ğŸ§", desc: "Seacon Square åº—æ¡è²·", loc: "Don Don Donki" },
                { time: "14:40", title: "é•·æ¦® BR0202 âœˆï¸", desc: "æ›¼è°· âœ æ¡ƒåœ’ | <span class='badge-res'>è±ªç¶“è‰™</span>", loc: "è˜‡å‡¡ç´å¸ƒæ©Ÿå ´" },
                { time: "19:15", title: "æŠµå°è¿”å®¶ ğŸ ", desc: "æ ¼ä¸Šæ¥é€", loc: "æ¡ƒåœ’æ©Ÿå ´" }
            ]}
        ];

        const ticketPdfs = [
            { cat: "ğŸš†", name: "è¼•äº•æ¾¤ JR å»ç¨‹", date: "1/24", url: "https://drive.google.com/file/d/1Sow2oYT30iCttJ2_xHUe_M3kCkIcG3ZC/preview" },
            { cat: "ğŸ¨", name: "Indigo é ç´„å–®", date: "1/24", url: "https://drive.google.com/file/d/1pingLAXnqXFqRAjCyO5dEYneBkz4euu0/preview" },
            { cat: "ğŸ¨", name: "ç‹å­è¥¿é¤¨é ç´„å–®", date: "1/25", url: "https://drive.google.com/file/d/1xd2_Cvs54ZogPjZWB_8oF9HZf2tKR0P4/preview" },
            { cat: "ğŸš†", name: "è¼•äº•æ¾¤ JR å›ç¨‹", date: "1/27", url: "https://drive.google.com/file/d/1iYGh9g4O2OsmiZdZsmuK7y5R1CAH-9NJ/preview" },
            { cat: "ğŸš†", name: "24å°æ™‚åœ°éµç¥¨", date: "1/27", url: "https://drive.google.com/file/d/1Wwzzh7JNsgyK3QfARdMoEafXDfvt3gYp/preview" },
            { cat: "ğŸ¨", name: "å”è‰é£¯åº—é ç´„å–®", date: "1/27", url: "https://drive.google.com/file/d/1zPgBegJ8Dzsvk24770fGbhz5XSR70i37/preview" },
            { cat: "âœ¨", name: "teamLab é–€ç¥¨", date: "1/29", url: "https://drive.google.com/file/d/19avX1gfW8gZKxyW357mpyHQZE1PvbllR/preview" },
            { cat: "ğŸ§±", name: "æ¨‚é«˜é–€ç¥¨", date: "1/29", url: "https://drive.google.com/file/d/1p-FameBs1VKSj8atbdJu2r4ACqwUAAqQ/preview" },
            { cat: "ğŸ—¼", name: "æ™´ç©ºå¡”é ç´„", date: "1/30", url: "https://drive.google.com/file/d/1zQpxy9o4X9TgIi-g8AL3rQStSg6VFYpF/preview" },
            { cat: "ğŸ¦–", name: "ç§‘å­¸åšç‰©é¤¨é ç´„", date: "1/30", url: "https://drive.google.com/file/d/1isA-IkiepBGwPcDvCKggK2TMesqkdOP-/preview" },
            { cat: "ğŸŸ", name: "æ± è¢‹æ°´æ—é¤¨é–€ç¥¨", date: "1/31", url: "https://drive.google.com/file/d/1kp3WUfaOmlIJd3PNhqYCCpiIJuWQImEO/preview" },
            { cat: "ğŸ¨", name: "æ›¼è°· MII é ç´„", date: "2/1", url: "https://drive.google.com/file/d/1UqZuOLTZQDEFGXjOym_VqUmF1VhYf2Hp/preview" }
        ];

        window.renderContent = function() {
            const container = document.getElementById('main-content');
            const dateKey = dates[window.currentDayIdx];
            
            // ğŸ’° 2/1ã€2/2 é–å®šæ³°éŠ–
            const isThaiTrip = dateKey.startsWith('2/'); 
            const currency = isThaiTrip ? 'THB' : 'JPY';
            document.getElementById('top-currency').innerText = currency + " MODE";

            if (window.currentMode === 'itinerary') {
                const data = tripData[window.currentDayIdx];
                let wUrl = data.city === "æ­¸é€”" ? "https://www.cwa.gov.tw/V8/C/W/Town/Town.html?TID=6300900" : "https://weather.yahoo.co.jp/weather/jp/13/4410.html";
                if (data.city === "è¼•äº•æ¾¤") wUrl = "https://weather.yahoo.co.jp/weather/jp/20/4820/20321.html";
                if (data.city === "æ›¼è°·") wUrl = "https://www.accuweather.com/zh/th/bangkok/318849/weather-forecast/318849";

                let html = `<div class="weather-banner" onclick="window.open('${wUrl}', '_blank')">
                    <div><p class="text-[10px] text-stone-400 font-bold uppercase">${data.city} Forecast</p>
                    <p class="text-xl font-black text-stone-800">æŸ¥çœ‹å¤©æ°£é å ± ğŸŒ¡ï¸</p></div>
                    <div class="text-right border-l pl-4 border-stone-200">
                    <p class="text-[10px] text-stone-400 font-bold uppercase">é ä¼°æº«åº¦</p>
                    <p class="text-sm font-black text-stone-600">${data.weather}</p></div></div>`;
                
                data.items.forEach(item => {
                    const navUrl = "http://maps.google.com/?q=" + encodeURIComponent(item.loc || item.title);
                    html += `<div class="muji-card p-6">
                        <span class="text-xl font-black text-stone-300 font-mono">${item.time}</span>
                        <h3 class="text-2xl font-black text-stone-800 mb-2 leading-tight">${item.title}</h3>
                        <p class="text-stone-500 mb-4 leading-relaxed">${item.desc || ""}</p>
                        <a href="${navUrl}" target="_blank" class="nav-map-btn">ğŸ“ åœ°åœ–å°èˆª</a>
                    </div>`;
                });
                container.innerHTML = html;
            } 
            else if (window.currentMode === 'map') {
                container.innerHTML = `<div class="map-wrapper"><iframe src="${myMapUrl}"></iframe></div>`;
            }
            else if (window.currentMode === 'ledger') {
                const dayExp = window.expensesRaw[dateKey.replace(/\//g, '-')] || {};
                let total = 0;
                let listHtml = Object.keys(dayExp).map(id => {
                    const item = dayExp[id]; total += item.amount;
                    return `<div class="ledger-row"><p class="font-bold">${item.name}</p><div class="flex items-center gap-4"><span class="font-black text-xl">${item.amount}</span><button onclick="window.deleteExp('${id}')" class="text-stone-300 text-2xl">Ã—</button></div></div>`;
                }).join('');
                container.innerHTML = `<div class="muji-card p-8 text-center bg-stone-800 text-white"><p class="text-stone-400 text-xs font-bold uppercase tracking-widest">ç•¶æ—¥ç¸½è¨ˆ (${currency})</p><p class="text-5xl font-black mt-2">${total}</p></div><div class="muji-card p-6">${listHtml || '<p class="text-center py-6 text-stone-300 italic">ç„¡ç´€éŒ„</p>'}</div><div class="muji-card p-6"><input type="text" id="exp-name" class="ledger-input mb-4" placeholder="å“é …..."><input type="number" id="exp-amount" class="ledger-input mb-6" placeholder="é‡‘é¡ (${currency})..."><button onclick="window.addExp()" class="w-full bg-stone-800 text-white py-4 rounded-xl font-bold">åŒæ­¥ç´€éŒ„</button></div>`;
            } 
            else if (window.currentMode === 'master') {
                let pdfHtml = ticketPdfs.map(pdf => `<a href="${pdf.url}" target="_blank" class="ticket-btn"><div class="flex-1"><p class="text-stone-400 text-[10px] font-bold uppercase mb-1">${pdf.date}</p><p class="font-bold text-stone-800">${pdf.cat} ${pdf.name}</p></div><div class="text-stone-300">âœ</div></a>`).join('');
                container.innerHTML = `<h2 class="text-stone-400 font-bold uppercase text-xs mb-4 tracking-widest">Tickets Vault</h2>${pdfHtml}`;
            }
        };

        // Firebase é‚è¼¯
        window.addExp = () => {
            const n = document.getElementById('exp-name').value;
            const a = parseInt(document.getElementById('exp-amount').value);
            if(!n || isNaN(a)) return;
            push(ref(db, 'expenses/' + dates[window.currentDayIdx].replace(/\//g, '-')), { name: n, amount: a });
            document.getElementById('exp-name').value = ''; document.getElementById('exp-amount').value = '';
        };

        window.deleteExp = (id) => { if(confirm('åˆªé™¤ï¼Ÿ')) remove(ref(db, `expenses/${dates[window.currentDayIdx].replace(/\//g, '-')}/${id}`)); };

        window.switchMode = (m) => {
            window.currentMode = m;
            document.querySelectorAll('.bottom-nav button').forEach(btn => btn.classList.replace('text-stone-800', 'text-stone-300'));
            const activeBtn = document.getElementById('mode-' + m);
            if(activeBtn) activeBtn.classList.replace('text-stone-300', 'text-stone-800');
            window.renderContent();
        };

        // åˆå§‹åŒ–
        const nav = document.getElementById('date-nav');
        dates.forEach((d, i) => {
            const btn = document.createElement('button');
            btn.className = `flex-shrink-0 px-7 py-3 rounded-2xl bg-white font-black border border-stone-200 transition-all ${i === 0 ? 'nav-active' : ''}`;
            btn.innerText = d;
            btn.onclick = (e) => {
                window.currentDayIdx = i;
                document.querySelectorAll('#date-nav button').forEach(b => b.classList.remove('nav-active'));
                e.currentTarget.classList.add('nav-active');
                window.renderContent();
            };
            nav.appendChild(btn);
        });

        onValue(ref(db, 'expenses'), snap => { window.expensesRaw = snap.val() || {}; window.renderContent(); });
        window.renderContent(); // åˆå§‹æ¸²æŸ“
    </script>
</body>
</html>
